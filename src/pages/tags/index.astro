---
import BaseLayout from '../../layouts/BaseLayout.astro';
import TagBadge from '../../components/TagBadge.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);

const tagCounts = allPosts.reduce<Record<string, number>>((acc, post) => {
  post.data.tags.forEach((tag) => {
    acc[tag] = (acc[tag] ?? 0) + 1;
  });
  return acc;
}, {});

const sortedTags = Object.entries(tagCounts).sort(([, a], [, b]) => b - a);
---

<BaseLayout title="Tags | Rafi Valli" description="All tags used on Rafi Valli's blog">
  <h1 class="text-3xl font-bold mb-8">All Tags</h1>
  {
    sortedTags.length > 0 ? (
      <div class="flex flex-wrap gap-4">
        {sortedTags.map(([tag, count]) => (
          <div class="flex items-center gap-2">
            <TagBadge tag={tag} />
            <span class="text-sm text-gray-500 dark:text-gray-400">({count})</span>
          </div>
        ))}
      </div>
    ) : (
      <p class="text-gray-500 dark:text-gray-400">No tags yet.</p>
    )
  }
</BaseLayout>
